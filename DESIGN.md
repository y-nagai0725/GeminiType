# `GeminiType` アプリ設計書 (Ver.2.1)

このドキュメントは、AI搭載タイピング練習アプリ `GeminiType` の基本設計をまとめたものです。

## 1. アプリの目的とターゲット

### 目的（優先度順）
1.  **ポートフォリオ:** 開発者の技術力（フルスタック開発、外部API連携、コンポーネント設計、DB設計）を証明する「ポートフォリオ作品」とする。
2.  **学習ツール:** 開発者自身（ターゲットユーザー）が、タイピング上達のために「楽しく」「継続して」使える学習ツールとする。
3.  **AIの体験:** AI (Gemini API) による問題生成の面白さを体験してもらう（アプリの「特徴」とする）。

### ターゲットユーザー
* **タイピング中級者:** ある程度打てるが、さらに速度と正確性を高めたい人。
* **プログラミング学習者:** コーディング練習（英数字・記号のタイピング）も兼ねて、楽しく練習したい人。

---

## 2. 機能一覧

### メイン機能 (Must Have)
* **タイピング機能:**
    * 日本語のお題をローマ字でタイピングする機能（**`TypingCore.vue` として部品化**）。
    * 「1セッション = **ユーザーが選択した問題数**（例: 10, 20, 30問）」の連続タイピング形式。
    * 進捗（例: 3 / 20 問目）の表示。
* **ユーザー認証 (JWT):**
    * ユーザー登録、ログイン機能（`email` と `password`）。
    * ※パスワードリセット機能は「実装しない」と明確に決定。
* **ゲスト（お試し）機能:**
    * 未ログインでも、タイピング機能（特殊モード含む）を遊べる。
    * ※結果のDB保存は不可。
* **問題生成 (Gemini API):**
    * ユーザーのお題に基づき、Geminiが「指定された問題数」を生成する。
* **問題生成 (DB):**
    * DBのジャンルから、「指定された問題数」をランダムで出題する。
* **結果管理 (セッション単位):**
    * ログインユーザーの「通常モード」の結果のみをDBに保存する。
* **管理画面:**
    * 管理者 (`is_admin=true`) のみアクセス可能。
    * ジャンル・問題文のCRUD（登録・閲覧・更新・削除）。
* **タイピング設定機能:**
    * 1セッションの**「問題数」**を選択できる。
    * 「タイピング音」「ミス音」のON/OFF。
    * これら「通常設定」は `localStorage` に保存し、次回も読み込む。

### サブ機能 (Want Have - メイン完成後)
* **特殊（ゲーム）モード:**
    * タイピング設定画面で選択可能（例: 制限時間モード、ミス即終了モード）。
    * **※特殊モードの結果は、DBには一切保存しない。**
* **管理画面で試し打ち:**
    * 管理画面(画面9)で、登録した問題を「試し打ち」できるモーダル機能（`TypingCore.vue` を再利用）。
* **マイページ統計表示:**
    * ログインユーザーの**「総タイプ数」**と**「総合平均WPM」**をマイページ(画面8)の目立つ場所に表示する。
* **「もう一度やる！」機能:**
    * 結果画面(画面7)にボタンを設置。
    * `localStorage` に保存した「直前のお題（ジャンルorAIお題）」を読み込み、即座に再挑戦できる。
* **グラフ表示:**
    * マイページにて、過去のセッション結果（平均WPMなど）の推移をグラフで視覚化する。
* **AIコメント:**
    * セッション結果に対し、Gemini APIがコメントをくれる（お遊び）。

---

## 3. ユーザーフロー

1.  **ゲスト (未ログイン):**
    * トップページ → 「お試し」 → メニュー → 「AI生成」or「DBジャンル」選択 → 設定画面（問題数やモード選択） → タイピング実行 → セッション結果表示。
    * ※結果画面で「この結果を保存するには登録してね」と誘導。
2.  **ログインユーザー:**
    * トップページ → ログイン → メニュー → 「AI生成」or「DBジャンル」選択 → 設定画面 → タイピング実行 → セッション結果表示。
    * ※「通常モード」の場合のみ、結果は自動でDBに保存される。
    * ※結果画面の「もう一度やる！」ボタンから、設定画面(画面11) or タイピング画面(画面6)に直接ジャンプできる。
    * マイページで過去の履歴（セッション一覧）を閲覧できる。

---

## 4. 画面一覧 (全11画面)

1.  **トップページ (LP):** アプリ紹介、お試し/登録/ログインへの導線。
2.  **ユーザー登録画面:**
3.  **ログイン画面:** (管理画面ログインとフォームを共通化)
4.  **メインメニュー画面:** 「AI生成」と「DBジャンル」の選択。
5.  **AI問題お題入力画面:** Geminiへのお題を入力するモーダルまたはページ。
6.  **タイピング実行画面:** 連続タイピングを行う画面。進捗も表示。**（※PC版に最適化）**
7.  **セッション結果画面:** 10問終了後の「まとめ結果」を表示。「もう一度やる！」ボタン設置。
8.  **マイページ:** 「総計」表示、過去の「セッション履歴（一覧）」を表示。
9.  **管理画面:** ジャンル・問題のCRUD用。「試し打ち」ボタン設置。
10. **セッション詳細画面:** マイページの履歴一覧から遷移。1セッションの「1問ごとの内訳」を表示。
11. **タイピング設定画面:** 「問題数」「特殊モード」「音設定」を選択する画面。**（※PC版に最適化）**

---

## 5. データベース設計

### テーブル定義
* **`users`** (ユーザー)
    * `id` (主キー)
    * `name` (ニックネーム)
    * `email` (メールアドレス, unique)
    * `password` (ハッシュ化パスワード)
    * `is_admin` (ブーリアン型, デフォルト: `false`)
* **`genres`** (DB問題のジャンル)
    * `id` (主キー)
    * `name` (ジャンル名, 例: `JavaScript`)
* **`problems`** (DB問題のマスター)
    * `id` (主キー)
    * `genre_id` (外部キー: `genres.id`)
    * `problem_text` (お題の日本語文, 例: `札幌市`)
* **`typing_sessions`** (まとめ記録)
    * `id` (主キー)
    * `user_id` (外部キー: `users.id`)
    * `session_type` (Enum: `db`, `gemini`)
    * `genre_id` (nullable)(ジャンルid)
    * `gemini_prompt` (nullable)(Geminiの生成のお題)
    * `average_kpm` (平均KPM)
    * `average_accuracy` (平均正確率)
    * `most_missed_key` (一番ミスしたキー)
    * `total_types` (Integer, このセッションの総タイプ数)
    * `created_at` (実施日時)
* **`session_problems`** (詳細記録)
    * `id` (主キー)
    * `session_id` (外部キー: `typing_sessions.id`)
    * `problem_text` (実際に打ったお題の日本語文)
    * `kpm` (この1問のKPM)
    * `accuracy` (この1問の正確率)
    * `missed_keys` (この1問でミスしたキー（JSON形式）)

### `localStorage` の活用
* **`user_settings`:** タイピング設定（問題数、音ON/OFF、特殊モード）を保存。
* **`last_session`:** 直前のセッション情報（type, id/prompt）を「もう一度やる！」機能のために保存。

---

## 6. 技術スタック (決定事項)

* **フロントエンド:** `Vue.js`
* **バックエンド:** `Node.js` + `Express`
* **データベース (本番):** `MySQL`
* **データベース (開発):** `SQLite`
* **ユーザー認証:** `JWT`
* **外部API:** `Gemini API`
* **日本語→ひらがな(外部API):** `Yahoo! Web API ルビ振り(v2)`
* **グラフ描画:** `vue-chartjs` or `vue-echarts` （採用候補）
* **レスポンシブ:**
    * **PC版に最適化:** タイピング実行画面(画面6), タイピング設定画面(画面11)
    * **全対応:** 上記以外の全画面