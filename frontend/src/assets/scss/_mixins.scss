@use "./_variables.scss" as *;
@use "sass:math";
@use "sass:meta";

// ==========================================
//  1. 数値から単位を取り除く関数
// ==========================================
@function strip-unit($number) {
  @if meta.type-of($number) == "number" and not math.is-unitless($number) {
    @return math.div($number, ($number * 0 + 1));
  }
  @return $number;
}

// ==========================================
//  2. pxをremに変換する関数
//     html { font-size: 62.5%; } 前提なので、10で割る
// ==========================================
@function px-to-rem($px) {
  $val: strip-unit($px);
  @return math.div($val, 10) * 1rem;
}

// ==========================================
//  3. clamp() をremで自動生成するmixin
// ==========================================
@mixin fluid-text($min-font-size, $max-font-size, $min-viewport: 375, $max-viewport: 1280) {
  // 単位除去
  $min-size: strip-unit($min-font-size);
  $max-size: strip-unit($max-font-size);
  $min-vw: strip-unit($min-viewport);
  $max-vw: strip-unit($max-viewport);

  // 傾き計算
  $size-diff: $max-size - $min-size;
  $vw-diff: $max-vw - $min-vw;

  $slope: math.div($size-diff, $vw-diff);
  $y-intercept: $min-size - ($slope * $min-vw);

  // 出力
  font-size: clamp(
    #{px-to-rem($min-size)},
    calc(#{px-to-rem($y-intercept)} + #{$slope * 100}vw),
    #{px-to-rem($max-size)}
  );
}

// ==========================================
//  4. 汎用版：プロパティを指定して可変にするMixin
//     使い方: @include fluid-style(padding-bottom, 20, 60);
// ==========================================
@mixin fluid-style($property, $min-value, $max-value, $min-vw: 375, $max-vw: 1280) {
  // 単位除去
  $min-val: strip-unit($min-value);
  $max-val: strip-unit($max-value);
  $min-vw: strip-unit($min-vw);
  $max-vw: strip-unit($max-vw);

  // 傾き計算
  $val-diff: $max-val - $min-val;
  $vw-diff: $max-vw - $min-vw;

  $slope: math.div($val-diff, $vw-diff);
  $y-intercept: $min-val - ($slope * $min-vw);

  // 指定されたプロパティに対して出力
  #{$property}: clamp(
    #{px-to-rem($min-val)},
    calc(#{px-to-rem($y-intercept)} + #{$slope * 100}vw),
    #{px-to-rem($max-val)}
  );
}

//タブレット用メディアクエリ
@mixin tab {
  @media screen and (min-width: 768px) {
    @content;
  }
}

//PC用メディアクエリ
@mixin pc {
  @media screen and (min-width: 1280px) {
    @content;
  }
}

//pc用hover
@mixin hover {
  @media (any-hover: hover) {
    &:hover {
      @content;
    }
  }
}

//コンテンツ幅
@mixin contents-width {
  padding: 0 2rem;

  @include tab {
    padding: 0 3rem;
  }

  @include pc {
    padding: 0;
    margin-inline: auto;
    width: 90%;
    max-width: 1200px;
  }
}

@mixin button-style {
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.8rem;
  font-weight: $bold;
  line-height: 1;
  letter-spacing: 0.1em;
  border-radius: 100vmax;
  transition:
    color $transition-base,
    background-color $transition-base;

  @include hover {
    svg {
      transform: translateX(8px);
    }
  }
}

@mixin button-style-border($font-color, $hovered-font-color: $white) {
  @include button-style;
  color: $font-color;
  border: 1px solid $font-color;
  background-color: transparent;

  @include hover {
    color: $hovered-font-color;
    background-color: $font-color;
  }
}

@mixin button-style-fill($fill-color, $font-color: $white) {
  @include button-style;
  color: $font-color;
  border: 1px solid $fill-color;
  background-color: $fill-color;

  @include hover {
    color: $fill-color;
    background-color: transparent;
  }
}

@mixin button-arrow-icon-style {
  width: 0.8em;
  fill: currentColor;
  transition: transform $transition-base;
}

// ==========================================
//  ページタイトル用Mixin
// ==========================================
@mixin page-title {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;

  @include fluid-style(gap, 16, 24);
  @include fluid-style(padding-block, 32, 48);

  // 背景のグレーの帯
  &::after {
    content: "";
    position: absolute;
    z-index: -1;
    top: 0;
    left: 50%;
    width: 100vw;
    height: 100%;
    transform: translateX(-50%);
    background-color: $gray;
  }

  // 英語部分 (.en)
  .en {
    font-family: $roboto-mono;
    @include fluid-text(30, 56);
    font-weight: $bold;
    letter-spacing: 0.05em;
    line-height: 1;
  }

  // 日本語部分 (.ja)
  .ja {
    @include fluid-text(14, 20);
    font-weight: $bold;
    letter-spacing: 0.1em;
    line-height: 1;
    color: $green;
  }
}

// ==========================================
//  コンテンツ余白用Mixin
// ==========================================
@mixin contents-padding {
  @include fluid-style(padding-top, 32, 48);
  @include fluid-style(padding-bottom, 80, 160);
}

// ==========================================
//  認証ページ（ログイン・ユーザー登録）Mixin
// ==========================================
@mixin auth-style {
  @include contents-width;
  max-width: 600px;
  margin-inline: auto;

  @include pc {
    max-width: 1000px;
  }

  &__title {
    @include page-title;
  }

  &__contents-wrapper {
    display: flex;
    flex-direction: column;
    @include fluid-style(gap, 32, 48);
    @include contents-padding;
  }

  &__link-wrapper {
    display: flex;
    justify-content: space-between;
    @include fluid-style(gap, 16, 24);
  }

  &__link {
    display: flex;
    flex-direction: column;
    @include fluid-style(gap, 8, 16);
    width: 50%;
    @include fluid-style(padding, 16, 24);
    color: $green;
    border: 1px solid $green;
    border-radius: $radius-md $radius-md 0 0;
    transition: background-color $transition-base;

    &--active {
      @include hover {
        background-color: $light-green;
      }
    }

    &--disable {
      color: $white;
      background-color: $green;
    }

    @include pc {
      flex-direction: row;
      align-items: center;
    }
  }

  &__link-text {
    font-weight: $bold;
    color: currentColor;

    &--jp {
      @include fluid-text(14, 16);
      letter-spacing: 0.1em;
    }

    &--en {
      font-family: $roboto-mono;
      @include fluid-text(12, 14);
      letter-spacing: 0.05em;
    }
  }

  &__form {
    display: flex;
    flex-direction: column;
    @include fluid-style(gap, 24, 32);
  }

  &__group {
    display: grid;
    grid-template-columns: 1fr;
    @include fluid-style(gap, 16, 24);

    @include pc {
      align-items: center;
      grid-template-columns: 1fr 3fr;
      gap: 0;
    }
  }

  &__label {
    @include fluid-text(14, 16);
    font-weight: $bold;
    letter-spacing: 0.1em;
  }

  &__label-notice {
    margin-left: 1em;
    color: $orange;
  }

  &__input {
    padding: 1em;
    @include fluid-text(14, 16);
    font-weight: $bold;
    line-height: 1;
    border-radius: $radius-md;
    background-color: $light-green;
    transition: box-shadow $transition-base;

    &:focus {
      box-shadow: 0 0 7px $blue;
    }
  }

  &__button {
    @include button-style-fill($blue);
    @include fluid-style(width, 240, 350);
    @include fluid-style(padding-block, 17, 22);
    @include fluid-style(margin-top, 8, 16);
    margin-inline: auto;
    @include fluid-text(14, 18);
  }

  &__arrow-icon {
    @include button-arrow-icon-style;
  }
}
